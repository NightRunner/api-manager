<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>action test</title>
    <link href="../plugins/bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="../plugins/jsonview/css/jquery.jsonview.css" rel="stylesheet" />
    <script src="../common/js/jquery-3.3.1.min.js"></script>
    <script src="../plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../plugins/mock/mock.js"></script>
    <script src="../plugins/jsonview/js/jquery.jsonview.js"></script>
    <script src="js/namespace.js"></script>
    <script src="../common/js/util.js"></script>
    <script src="js/jquery.chosen.js"></script>
    <script src="js/jquery.param.js"></script>
    <script src="../common/js/jquery.md5.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div id="requestHead" style="width: 100%;">
            <p style="text-align: center;font-family: Microsoft YaHei; font-size:larger; background-color: #9fcdff;margin-bottom: 0px;">请求头参数</p>
        </div>
    </div>
    <div class="row">
        <div id="requestParam" style="width: 100%; overflow: auto;">
            <p style="text-align: center;font-family: Microsoft YaHei; font-size:larger; background-color: #9fcdff;margin-bottom: 0px;">请求参数</p>
        </div>
    </div>
    <div class="row">
        <div class="input-group col-6" style="padding-left: 0px;">
            <label>接口地址：</label>
            <input name="requestUrl" class="form-control" style="font-family: Microsoft YaHei;font-size: 15px;"></input>
        </div>
        <div class="input-group col-4" style="padding-left: 0px;">
            <label>接口类型：</label>
            <select name="requestType" class="form-control"></select>
        </div>
        <div class="input-group col-2">
            <button id="sendRequest" class="btn btn-info">发送请求</button>
        </div>
        <hr style="width: 100%;">
    </div>
    <div class="row">
        <div class="col-2" style="padding-left: 0px;">
            <a id="requestJsonFormatLink" style="color:#17a2b8; cursor: pointer;">格式化</a>
        </div>
        <div class="col-2" style="padding-left: 0px;">
            <a id="requestJsonRowLink" style="color:#17a2b8; cursor: pointer;">行模式</a>
        </div>
        <hr style="width: 100%; margin-top: 1px;">
    </div>
    <div class="row">
        <div>
            <label>请求数据：</label>
        </div>
    </div>
    <div class="row">
        <div id="requestJson"></div>
        <textarea id="requestJsonArea" class="form-control" style="display: none; font-family: 宋体;font-size: 14px; height: 40px;"></textarea>
        <hr style="width: 100%;">
    </div>

    <div class="row">
        <div class="col-2" style="padding-left: 0px;">
            <a id="responseJsonFormatLink" style="color:#17a2b8; cursor: pointer;">格式化</a>
        </div>
        <div class="col-2" style="padding-left: 0px;">
            <a id="responseJsonRowLink" style="color:#17a2b8; cursor: pointer;">行模式</a>
        </div>
        <hr style="width: 100%; margin-top: 1px;">
    </div>
    <div class="row">
        <div>
            <label>返回数据：</label>
        </div>
    </div>
    <div class="row">
        <div id="responseJson"></div>
        <textarea id="responseJsonArea" class="form-control" style="display: none; font-family: 宋体;font-size: 14px; height: 40px;"></textarea>
    </div>
</div>

<script>
    var headOptions = {
        container: '#requestHead',
        headers: [
            {text: '操作', width: '5%'},
            {text: '名称', width: '15%'},
            {text: '含义', width: '20%'},
            {text: '类型', width: '20%'},
            {text: '默认值', width: '20%'}
        ],
        fields: [
            {name: 'name', type: 'input'},
            {name: 'desc', type: 'input'},
            {
                name: 'type', type: 'select', options: {
                    width: '100%',
                    height: '100%',
                    optionField: {value: 'k', text: 'v'},
                    url: '/apimanager/meta/findMeta',
                    params: {metaId: 1}
                }
            },
            {name: 'defaultVal', type: 'input'}
        ],
        footBtn: [
            {
                type: 'add', text: '添加参数', fn: function (row) {
                }
            }
        ]
    };

    var requestOptions = {
        container: '#requestParam',
        headers: [
            {text: '操作', width: '5%'},
            {text: '名称', width: '15%'},
            {text: '含义', width: '20%'},
            {text: '类型', width: '20%'},
            {text: '规则', width: '20%'},
            {text: '默认值', width: '20%'}
        ],
        fields: [
            {name: 'name', type: 'input'},
            {name: 'desc', type: 'input'},
            {
                name: 'type', type: 'select', options: {
                    width: '100%',
                    height: '100%',
                    optionField: {value: 'k', text: 'v'},
                    url: '/apimanager/meta/findMeta',
                    params: {metaId: 1}
                }
            },
            {name: 'rule', type: 'input'},
            {name: 'defaultVal', type: 'input'}
        ],
        footBtn: [
            {
                type: 'add', text: '添加参数', fn: function (row) {
                }
            }
        ]
    };

    var headParam = api.ui.param(headOptions);
    var requestParam = api.ui.param(requestOptions);

    $('#sendRequest').on('click', function () {
        var requestMockTemplate = api.util.buildMockTemplate(requestParam.toData());
        var headMockTemplate = api.util.buildMockTemplate(headParam.toData());
        var requestData = Mock.mock(requestMockTemplate);
        var headData = Mock.mock(headMockTemplate);
        $('#requestJson').JSONView(JSON.stringify(requestData));
        $('#requestJsonArea').val(JSON.stringify(requestData));

        var requestBody = {};
        requestBody['requestType'] = 1;
        requestBody['requestUrl'] = 'http://core.test.tiebaobei.com/core/home/findById';
        requestBody['requestHeadData'] = JSON.stringify(headData);
        requestBody['requestData'] = JSON.stringify(requestData);
        $.ajax({
            url: api.util.getUrl('apimanager/tester/send'),
            type: 'POST',
            data: requestBody,
            dataType: 'json',
            success: function (result) {
                var data = result.data;
                $('#responseJsonArea').val(JSON.stringify(data));
                $('#responseJson').JSONView(JSON.stringify(data));
            }
        });
    });
    
    $('#requestJsonFormatLink').on('click', function () {
        $('#requestJson').css('display', '');
        $('#requestJsonArea').css('display', 'none');
    });

    $('#requestJsonRowLink').on('click', function () {
        $('#requestJson').css('display', 'none');
        $('#requestJsonArea').css('display', '');
    });

    $('#responseJsonFormatLink').on('click', function () {
        $('#responseJson').css('display', '');
        $('#responseJsonArea').css('display', 'none');
    });

    $('#responseJsonRowLink').on('click', function () {
        $('#responseJson').css('display', 'none');
        $('#responseJsonArea').css('display', '');
    });
</script>
</body>
</html>